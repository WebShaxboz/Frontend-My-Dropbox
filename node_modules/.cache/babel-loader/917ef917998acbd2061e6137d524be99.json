{"ast":null,"code":"import _objectSpread from\"/Users/student/Desktop/drop/Frontend-My-Dropbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/student/Desktop/drop/Frontend-My-Dropbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/student/Desktop/drop/Frontend-My-Dropbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import ReactDOM from\"react-dom\";import{faFileImport}from\"@fortawesome/free-solid-svg-icons\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{useAuth}from\"../../contexts/AuthContext\";import{storage,database}from\"../../Server/firebase\";import{ROOT_FOLDER}from\"../../hooks/useFolder\";import{v4 as uuidV4}from\"uuid\";import'./AddFileButton.css';export default function AddFileButton(_ref){var currentFolder=_ref.currentFolder;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),uploadingFiles=_useState2[0],setUploadingFiles=_useState2[1];var _useAuth=useAuth(),currentUser=_useAuth.currentUser;function handleUpload(e){var file=e.target.files[0];if(currentFolder==null||file==null)return;var id=uuidV4();setUploadingFiles(function(prevUploadingFiles){return[].concat(_toConsumableArray(prevUploadingFiles),[{id:id,name:file.name,progress:0,error:false}]);});var filePath=currentFolder===ROOT_FOLDER?\"\".concat(currentFolder.path.join(\"/\"),\"/\").concat(file.name):\"\".concat(currentFolder.path.join(\"/\"),\"/\").concat(currentFolder.name,\"/\").concat(file.name);var uploadTask=storage.ref(\"/files/\".concat(currentUser.uid,\"/\").concat(filePath)).put(file);uploadTask.on(\"state_changed\",function(snapshot){var progress=snapshot.bytesTransferred/snapshot.totalBytes;setUploadingFiles(function(prevUploadingFiles){return prevUploadingFiles.map(function(uploadFile){if(uploadFile.id===id){return _objectSpread(_objectSpread({},uploadFile),{},{progress:progress});}return uploadFile;});});},function(){setUploadingFiles(function(prevUploadingFiles){return prevUploadingFiles.map(function(uploadFile){if(uploadFile.id===id){return _objectSpread(_objectSpread({},uploadFile),{},{error:true});}return uploadFile;});});},function(){setUploadingFiles(function(prevUploadingFiles){return prevUploadingFiles.filter(function(uploadFile){return uploadFile.id!==id;});});uploadTask.snapshot.ref.getDownloadURL().then(function(url){database.files.where(\"name\",\"==\",file.name).where(\"userId\",\"==\",currentUser.uid).where(\"folderId\",\"==\",currentFolder.id).get().then(function(existingFiles){var existingFile=existingFiles.docs[0];if(existingFile){existingFile.ref.update({url:url});}else{database.files.add({url:url,name:file.name,createdAt:database.getCurrentTimestamp(),folderId:currentFolder.id,userId:currentUser.uid});}});});});}return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"label\",{className:\"addFile-container\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faFileImport,className:\"addFile-icon\"}),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",onChange:handleUpload,className:\"addFile-input\"})),uploadingFiles.length>0&&ReactDOM.createPortal(/*#__PURE__*/React.createElement(\"div\",{className:\"addFile-upload\"},uploadingFiles.map(function(file){return/*#__PURE__*/React.createElement(\"ul\",{key:file.id,onClose:function onClose(){setUploadingFiles(function(prevUploadingFiles){return prevUploadingFiles.filter(function(uploadFile){return uploadFile.id!==file.id;});});}},/*#__PURE__*/React.createElement(\"li\",{closeButton:file.error},file.name),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{animated:!file.error,variant:file.error?\"danger\":\"primary\",now:file.error?100:file.progress*100,label:file.error?\"Error\":\"\".concat(Math.round(file.progress*100),\"%\")})));})),document.body));}","map":{"version":3,"sources":["/Users/student/Desktop/drop/Frontend-My-Dropbox/src/components/AddFileButton/AddFileButton.js"],"names":["React","useState","ReactDOM","faFileImport","FontAwesomeIcon","useAuth","storage","database","ROOT_FOLDER","v4","uuidV4","AddFileButton","currentFolder","uploadingFiles","setUploadingFiles","currentUser","handleUpload","e","file","target","files","id","prevUploadingFiles","name","progress","error","filePath","path","join","uploadTask","ref","uid","put","on","snapshot","bytesTransferred","totalBytes","map","uploadFile","filter","getDownloadURL","then","url","where","get","existingFiles","existingFile","docs","update","add","createdAt","getCurrentTimestamp","folderId","userId","length","createPortal","Math","round","document","body"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\"\r\nimport ReactDOM from \"react-dom\"\r\nimport { faFileImport } from \"@fortawesome/free-solid-svg-icons\"\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\r\nimport { useAuth } from \"../../contexts/AuthContext\"\r\nimport { storage, database } from \"../../Server/firebase\"\r\nimport { ROOT_FOLDER } from \"../../hooks/useFolder\"\r\nimport { v4 as uuidV4 } from \"uuid\"\r\nimport './AddFileButton.css'\r\n\r\nexport default function AddFileButton({ currentFolder }) {\r\n  const [uploadingFiles, setUploadingFiles] = useState([])\r\n  const { currentUser } = useAuth()\r\n\r\n  function handleUpload(e) {\r\n    const file = e.target.files[0]\r\n    if (currentFolder == null || file == null) return\r\n\r\n    const id = uuidV4()\r\n    setUploadingFiles(prevUploadingFiles => [\r\n      ...prevUploadingFiles,\r\n      { id: id, name: file.name, progress: 0, error: false },\r\n    ])\r\n    const filePath =\r\n      currentFolder === ROOT_FOLDER\r\n        ? `${currentFolder.path.join(\"/\")}/${file.name}`\r\n        : `${currentFolder.path.join(\"/\")}/${currentFolder.name}/${file.name}`\r\n\r\n    const uploadTask = storage\r\n      .ref(`/files/${currentUser.uid}/${filePath}`)\r\n      .put(file)\r\n\r\n    uploadTask.on(\r\n      \"state_changed\",\r\n      snapshot => {\r\n        const progress = snapshot.bytesTransferred / snapshot.totalBytes\r\n        setUploadingFiles(prevUploadingFiles => {\r\n          return prevUploadingFiles.map(uploadFile => {\r\n            if (uploadFile.id === id) {\r\n              return { ...uploadFile, progress: progress }\r\n            }\r\n\r\n            return uploadFile\r\n          })\r\n        })\r\n      },\r\n      () => {\r\n        setUploadingFiles(prevUploadingFiles => {\r\n          return prevUploadingFiles.map(uploadFile => {\r\n            if (uploadFile.id === id) {\r\n              return { ...uploadFile, error: true }\r\n            }\r\n            return uploadFile\r\n          })\r\n        })\r\n      },\r\n      () => {\r\n        setUploadingFiles(prevUploadingFiles => {\r\n          return prevUploadingFiles.filter(uploadFile => {\r\n            return uploadFile.id !== id\r\n          })\r\n        })\r\n\r\n        uploadTask.snapshot.ref.getDownloadURL().then(url => {\r\n          database.files\r\n            .where(\"name\", \"==\", file.name)\r\n            .where(\"userId\", \"==\", currentUser.uid)\r\n            .where(\"folderId\", \"==\", currentFolder.id)\r\n            .get()\r\n            .then(existingFiles => {\r\n              const existingFile = existingFiles.docs[0]\r\n              if (existingFile) {\r\n                existingFile.ref.update({ url: url })\r\n              } else {\r\n                database.files.add({\r\n                  url: url,\r\n                  name: file.name,\r\n                  createdAt: database.getCurrentTimestamp(),\r\n                  folderId: currentFolder.id,\r\n                  userId: currentUser.uid,\r\n                })\r\n              }\r\n            })\r\n        })\r\n      }\r\n    )\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <label className=\"addFile-container\">\r\n        <FontAwesomeIcon icon={faFileImport}className=\"addFile-icon\" />\r\n        <input\r\n          type=\"file\"\r\n          onChange={handleUpload}\r\n          className=\"addFile-input\"\r\n        />\r\n      </label>\r\n      {uploadingFiles.length > 0 &&\r\n        ReactDOM.createPortal(\r\n          <div className=\"addFile-upload\">\r\n            {uploadingFiles.map(file => (\r\n              <ul\r\n                key={file.id}\r\n                onClose={() => {\r\n                  setUploadingFiles(prevUploadingFiles => {\r\n                    return prevUploadingFiles.filter(uploadFile => {\r\n                      return uploadFile.id !== file.id\r\n                    })\r\n                  })\r\n                }}\r\n              >\r\n                <li\r\n                  closeButton={file.error}\r\n                >\r\n                  {file.name}\r\n                </li>\r\n                <div>\r\n                  <div\r\n                    animated={!file.error}\r\n                    variant={file.error ? \"danger\" : \"primary\"}\r\n                    now={file.error ? 100 : file.progress * 100}\r\n                    label={\r\n                      file.error\r\n                        ? \"Error\"\r\n                        : `${Math.round(file.progress * 100)}%`\r\n                    }\r\n                  />\r\n                </div>\r\n              </ul>\r\n            ))}\r\n          </div>,\r\n          document.body\r\n        )}\r\n    </>\r\n  )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}